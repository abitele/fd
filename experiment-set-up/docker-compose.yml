version: "3.7"

services:

  # MySQL with multiple DBs
  mysql:
    image: mysql:8.0
    container_name: mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
    ports:
      - "${MYSQL_PORT}:3306"
    volumes:
      - mysql-db:/var/lib/mysql
      - ./mysql-init:/docker-entrypoint-initdb.d

  # PostgreSQL + PostGIS with multiple DBs
  postgres:
    image: postgis/postgis:14-3.3
    container_name: postgres
    restart: always
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    ports:
      - "${POSTGRES_PORT}:5432"
    volumes:
      - postgres-db:/var/lib/postgresql/data
      - ./postgres-init:/docker-entrypoint-initdb.d

  # MongoDB with multiple DBs (via JS init)
  mongodb:
    image: mongo:6
    container_name: mongodb
    restart: always
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
    ports:
      - "${MONGO_PORT}:27017"
    volumes:
      - mongo-db:/data/db
      - ./mongo-init:/docker-entrypoint-initdb.d

  # MSSQL with multiple DBs
  mssql:
    image: mcr.microsoft.com/mssql/server:2022-lts
    container_name: mssql
    restart: always
    environment:
      SA_PASSWORD: ${MSSQL_SA_PASSWORD}
      ACCEPT_EULA: "Y"
    ports:
      - "${MSSQL_PORT}:1433"
    volumes:
      - mssql-db:/var/opt/mssql
      - ./mssql-init:/docker-entrypoint-initdb.d

  # phpMyAdmin for MySQL
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin
    restart: always
    ports:
      - "8080:80"
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306

  # pgAdmin for PostgreSQL
  pgadmin:
    image: dpage/pgadmin4
    container_name: pgadmin
    restart: always
    ports:
      - "8081:80"
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@pg.local
      PGADMIN_DEFAULT_PASSWORD: admin
    volumes:
      - pgadmin-data:/var/lib/pgadmin

  # Mongo Express
  mongo-express:
    image: mongo-express
    container_name: mongo-express
    restart: always
    ports:
      - "8082:8081"
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: ${MONGO_INITDB_ROOT_USERNAME}
      ME_CONFIG_MONGODB_ADMINPASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
      ME_CONFIG_MONGODB_SERVER: mongodb

  # Adminer (can connect to all SQL DBs)
  adminer:
    image: adminer
    container_name: adminer
    restart: always
    ports:
      - "8083:8080"

  # Teiid data federation engine
  teiid:
    image: quay.io/teiid/teiid-server:latest
    container_name: teiid
    restart: always
    ports:
      - "31000:8080"     # Web UI
      - "35432:35432"    # JDBC
    environment:
      JAVA_OPTS_APPEND: "-Xms512m -Xmx1024m"
    volumes:
      - teiid-data:/opt/jboss/teiid-data

volumes:
  mysql-db:
  postgres-db:
  mongo-db:
  mssql-db:
  pgadmin-data:
  teiid-data:
